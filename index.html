<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kart Takip Pro</title>
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#DA291C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
</head>

<body class="select-none">

    <!-- SHIFRE EKRANI (PIN) -->
    <div id="pinScreen">
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold mb-2">Kart Takip Pro</h1>
            <p id="pinStatus" class="opacity-70 text-sm font-medium">G√ºvenli giri≈ü i√ßin ≈üifreyi girin</p>
        </div>

        <div class="flex gap-6 mb-4" id="pinDisplay">
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
        </div>

        <div class="numpad">
            <button class="num-btn" onclick="pressNum(1)">1</button>
            <button class="num-btn" onclick="pressNum(2)">2</button>
            <button class="num-btn" onclick="pressNum(3)">3</button>
            <button class="num-btn" onclick="pressNum(4)">4</button>
            <button class="num-btn" onclick="pressNum(5)">5</button>
            <button class="num-btn" onclick="pressNum(6)">6</button>
            <button class="num-btn" onclick="pressNum(7)">7</button>
            <button class="num-btn" onclick="pressNum(8)">8</button>
            <button class="num-btn" onclick="pressNum(9)">9</button>
            <button class="num-btn" style="background:transparent" onclick="clearPin()">C</button>
            <button class="num-btn" onclick="pressNum(0)">0</button>
            <button class="num-btn" style="background:transparent" onclick="delPin()">‚å´</button>
        </div>
    </div>

    <!-- ANA HEADER -->
    <header class="shadow-xl">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 id="headerTitle" class="text-2xl font-bold">KKTPRO 2.0</h1>
                <div class="flex items-center gap-2">
                    <p class="text-[10px] opacity-70 font-bold uppercase tracking-widest mt-0.5">Finansal Durumunuz</p>
                    <div id="syncIndicator" class="hidden text-[10px] font-bold text-gray-500 flex items-center gap-1">
                        <span id="syncIcon">‚òÅÔ∏è</span> <span id="syncText">SYNC</span>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="logoutApp()"
                    class="w-12 h-12 bg-gray-100 dark:bg-slate-700 rounded-full flex items-center justify-center font-bold text-[10px] hover:bg-gray-200 transition-colors uppercase">üîê</button>
                <button onclick="switchTab('borc', this)"
                    class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center font-bold text-[10px] hover:bg-white/40 transition-colors uppercase">BOR√á</button>
            </div>
        </div>
    </header>

    <main>
        <!-- TAB 1: √ñZET -->
        <div id="tab-ozet" class="tab-content active px-4">
            <div class="summary-grid mb-6">
                <div id="card-limit" onclick="showDetail('limit', this)" class="ak-card summary-card active">
                    <p class="text-[9px] font-bold text-gray-400 uppercase leading-none mb-1 text-center">Toplam Limit
                    </p>
                    <h3 id="totalLimit" class="text-sm font-bold text-gray-800 dark:text-gray-100 text-center">0,00 TL
                    </h3>
                </div>
                <div id="card-usable" onclick="showDetail('usable', this)" class="ak-card summary-card">
                    <p class="text-[9px] font-bold text-green-500 uppercase leading-none mb-1 text-center">
                        Kullanƒ±labilir Limit</p>
                    <h3 id="totalUsable" class="text-sm font-bold text-green-600 text-center">0,00 TL</h3>
                </div>
                <div id="card-debt" onclick="showDetail('debt', this)"
                    class="ak-card summary-card border-l-4 border-[#DA291C]">
                    <p class="text-[9px] font-bold text-[#DA291C] uppercase leading-none mb-1 text-center">TOPLAM BOR√á
                    </p>
                    <h3 id="totalDebt" class="text-sm font-bold text-[#DA291C] text-center">0,00 TL</h3>
                </div>
                <div id="card-upcoming" onclick="showDetail('upcoming', this)"
                    class="ak-card summary-card bg-indigo-600 text-white border-none shadow-indigo-100 dark:shadow-none">
                    <p id="upcomingLabel"
                        class="text-[9px] font-bold text-indigo-100 uppercase leading-none mb-1 text-center tracking-tighter">
                        √ñDEME YOK</p>
                    <h3 id="upcomingAmount" class="text-sm font-bold text-white text-center uppercase">0,00 TL</h3>
                </div>
            </div>

            <!-- DETAY PANELƒ∞ -->
            <div id="detailPanel" class="ak-card p-0 mb-6 overflow-hidden">
                <div onclick="toggleSection('detailListBody', this)"
                    class="flex justify-between items-center p-5 cursor-pointer bg-gray-50/50 dark:bg-gray-800/20 active:bg-gray-100 transition-colors">
                    <h4 id="detailTitle" class="text-[11px] font-bold text-gray-400 uppercase tracking-wider">BOR√á
                        DETAYLARI</h4>
                    <span class="toggle-icon text-gray-300 text-xs">‚ñº</span>
                </div>
                <div id="detailListBody" class="p-5 pt-0 border-t dark:border-gray-800">
                    <div id="detailList" class="space-y-3 max-h-[300px] overflow-y-auto pr-2 custom-scroll mt-4"></div>
                </div>
            </div>

            <!-- SON √ñDEME Lƒ∞STESƒ∞ -->
            <section class="mb-6">
                <div onclick="toggleSection('dueListBody', this)"
                    class="flex justify-between items-center px-1 mb-3 cursor-pointer group">
                    <h3 class="text-xs font-bold text-gray-400 uppercase group-active:text-gray-600">Son √ñdeme Tarihi
                        Yakla≈üanlar</h3>
                    <span class="toggle-icon text-gray-300 text-xs">‚ñº</span>
                </div>
                <div id="dueListBody" class="space-y-3"></div>
            </section>

            <!-- HESAP KESƒ∞M Lƒ∞STESƒ∞ -->
            <section class="mb-8">
                <div onclick="toggleSection('cutoffListBody', this)"
                    class="flex justify-between items-center px-1 mb-3 cursor-pointer group">
                    <h3 class="text-xs font-bold text-gray-500 uppercase group-active:text-gray-700">Hesap Kesim Tarihi
                        Yakla≈üanlar</h3>
                    <span class="toggle-icon text-gray-300 text-xs">‚ñº</span>
                </div>
                <div id="cutoffListBody" class="space-y-3"></div>
            </section>
        </div>

        <!-- TAB: TAKVƒ∞M (CALENDAR) -->
        <div id="tab-takvim" class="tab-content px-4">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-6 px-1">√ñdeme Takvimi</h2>
            <div id="calendar" class="ak-card p-4 bg-white dark:bg-slate-800 border-none shadow-xl min-h-[400px]"></div>
            <div id="dayDetailPanel" class="hidden mt-6 ak-card p-5 animate-slideUp">
                <h3 id="selectedDateTitle" class="text-xs font-bold text-gray-400 uppercase mb-4 border-b pb-2">G√úN
                    DETAYI</h3>
                <div id="dayDetailList" class="space-y-3"></div>
            </div>
        </div>

        <!-- TAB 2: BANKALARIM -->
        <div id="tab-banka" class="tab-content px-4">
            <div class="flex justify-between items-center mb-6 px-1">
                <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100">Bankalarƒ±m</h2>
                <button onclick="openAddBank()"
                    class="bg-[#DA291C] text-white px-5 py-2.5 rounded-full text-xs font-bold shadow-lg shadow-red-200">+
                    BANKA</button>
            </div>
            <div id="bankList" class="space-y-4"></div>
        </div>

        <!-- TAB 3: DAHA FAZLA -->
        <div id="tab-more" class="tab-content px-4">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-8 px-1">Ayarlar</h2>
            <div class="space-y-4">
                <div onclick="changePin()"
                    class="ak-card p-5 flex items-center justify-between active:bg-gray-50 dark:active:bg-gray-800">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-full bg-red-50 dark:bg-red-900/20 flex items-center justify-center text-lg">
                            üîë</div>
                        <div>
                            <h4 class="text-sm font-bold">Giri≈ü ≈ûifresi</h4>
                            <p class="text-[10px] text-gray-400">4 haneli g√ºvenliƒüi deƒüi≈ütirin</p>
                        </div>
                    </div>
                    <span class="text-gray-300">‚ùØ</span>
                </div>

                <div class="ak-card p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div
                            class="w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-lg">
                            üíæ</div>
                        <h4 class="text-sm font-bold">Veri Yedekleme</h4>
                    </div>
                    <p class="text-[10px] text-gray-400 mb-4 font-medium">Uygulama yerel √ßalƒ±≈üƒ±r. Verilerinizi manuel
                        olarak yedekleyip ba≈üka telefona aktarabilirsiniz.</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="exportData()"
                            class="py-3 bg-gray-50 dark:bg-gray-800 border dark:border-gray-700 rounded-xl text-[10px] font-bold text-gray-600 dark:text-gray-300">YEDEK
                            AL (.json)</button>
                        <button onclick="document.getElementById('importFile').click()"
                            class="py-3 bg-gray-900 dark:bg-slate-700 border dark:border-slate-600 text-white rounded-xl text-[10px] font-bold">YEDEK
                            Y√úKLE</button>
                    </div>
                    <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
                </div>

                <div onclick="showBonusList()"
                    class="ak-card p-5 flex items-center justify-between active:bg-gray-50 dark:active:bg-gray-800">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-full bg-yellow-50 dark:bg-yellow-900/20 flex items-center justify-center text-lg">
                            ‚ú®</div>
                        <div>
                            <h4 class="text-sm font-bold">Bonuslarƒ±m</h4>
                            <p class="text-[10px] text-gray-400">Kart birikmi≈ülerini takip edin</p>
                        </div>
                    </div>
                    <span class="text-gray-300">‚ùØ</span>
                </div>

                <div class="p-8 text-center opacity-30">
                    <p class="text-[10px] font-bold tracking-widest uppercase">KKTPRO V20.0.0</p>
                    <p class="text-[9px] mt-1 font-medium">Sercan Topaloƒülu Edition &bull; M√ºkemmellik i√ßin tasarlandƒ±.
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB 4: BOR√á TAKƒ∞Bƒ∞ -->
        <div id="tab-borc" class="tab-content">
            <div id="personListView">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold uppercase">Ki≈üi / Kurum</h2>
                    <button onclick="openAddPerson()"
                        class="bg-gray-900 dark:bg-slate-700 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg">+
                        EKLE</button>
                </div>
                <div id="personList" class="space-y-3"></div>
            </div>

            <div id="personDetailView" class="hidden">
                <div class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-xl mb-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-[#DA291C]"></div>
                    <div class="absolute top-6 right-6 flex items-center gap-3">
                        <button onclick="deletePerson()"
                            class="w-8 h-8 flex items-center justify-center text-sm opacity-20 hover:opacity-100 transition-opacity">üóëÔ∏è</button>
                        <button onclick="closePersonDetail()"
                            class="text-gray-300 hover:text-gray-500 transition-colors text-xl">‚úï</button>
                    </div>
                    <h2 id="detailPersonName" class="text-2xl font-bold mb-1">---</h2>
                    <p id="detailPersonBalance" class="text-sm font-bold opacity-60 uppercase tracking-tighter">Bakiye:
                        0,00 TL</p>
                </div>

                <div class="flex gap-4 mb-8 justify-center">
                    <button onclick="openTransactionModal('ALACAK')"
                        class="w-32 h-32 bg-green-600 text-white rounded-[2rem] font-bold text-xs shadow-xl shadow-green-100 flex flex-col items-center justify-center gap-3 uppercase transition-transform active:scale-95">
                        <span class="text-3xl">‚¨áÔ∏è</span> VERDƒ∞M
                    </button>
                    <button onclick="openTransactionModal('BORC')"
                        class="w-32 h-32 bg-red-600 text-white rounded-[2rem] font-bold text-xs shadow-xl shadow-red-100 flex flex-col items-center justify-center gap-3 uppercase transition-transform active:scale-95">
                        <span class="text-3xl">‚¨ÜÔ∏è</span> ALDIM
                    </button>
                </div>

                <div class="space-y-3">
                    <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-1">Hareket Ge√ßmi≈üi</h3>
                    <div id="transactionList" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- ALT NAVIGASYON -->
    <nav class="bottom-nav">
        <button onclick="switchTab('ozet', this)" class="nav-item active">
            <span class="nav-icon">üè†</span><span>√ñZET</span>
        </button>
        <button onclick="switchTab('banka', this)" class="nav-item">
            <span class="nav-icon">üí≥</span><span>BANKALAR</span>
        </button>
        <button onclick="switchTab('takvim', this)" class="nav-item">
            <span class="nav-icon">üìÖ</span><span>TAKVƒ∞M</span>
        </button>
        <button onclick="switchTab('more', this)" class="nav-item">
            <span class="nav-icon">‚öôÔ∏è</span><span>AYARLAR</span>
        </button>
    </nav>

    <!-- MODALLAR -->
    <div id="bankModal"
        class="modal-overlay hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-6 z-[2000]">
        <div class="modal-content bg-white dark:bg-slate-800 p-6 w-full max-w-sm rounded-[2.5rem] shadow-2xl relative"
            onclick="event.stopPropagation()">
            <button onclick="closeModal('bankModal')"
                class="absolute top-6 right-6 text-gray-300 hover:text-gray-500 transition-colors text-xl">‚úï</button>
            <h2 id="bankModalTitle" class="text-xl font-bold mb-6">Banka Ekle</h2>
            <input type="hidden" id="editBankId">
            <div class="space-y-4">
                <div><label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">Banka ƒ∞smi</label><input
                        type="text" id="bankName" placeholder="Ziraat, Enpara..."
                        class="w-full p-4 bg-gray-50 dark:bg-gray-700 text-sm"></div>
                <div><label class="text-[10px] text-gray-400 font-bold ml-1 uppercase text-[#DA291C]">Toplam
                        Limit</label><input type="text" id="bLimit" inputmode="decimal" oninput="maskInput(this)"
                        placeholder="0,00"
                        class="w-full p-5 bg-gray-50 dark:bg-gray-700 text-2xl font-bold border-none"></div>
                <div><label
                        class="text-[10px] text-gray-400 font-bold ml-1 uppercase text-green-600">Kullanƒ±labilir</label><input
                        type="text" id="bUsable" inputmode="decimal" oninput="maskInput(this)" placeholder="0,00"
                        class="w-full p-5 bg-gray-50 dark:bg-gray-700 text-2xl font-bold border-none"></div>
            </div>
            <button onclick="saveBank()" class="w-full mt-8 ak-btn-primary py-5">KAYDET</button>
        </div>
    </div>

    <div id="cardModal"
        class="modal-overlay hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-6 z-[2000]">
        <div class="modal-content bg-white dark:bg-slate-800 p-6 w-full max-w-sm rounded-[2.5rem] shadow-2xl relative"
            onclick="event.stopPropagation()">
            <button onclick="closeModal('cardModal')"
                class="absolute top-6 right-6 text-gray-300 hover:text-gray-500 transition-colors text-xl">‚úï</button>
            <h2 id="cardModalTitle" class="text-xl font-bold mb-6">Kart Detayƒ±</h2>
            <input type="hidden" id="targetBankId"><input type="hidden" id="editCardIdx">
            <div class="space-y-4">
                <div><label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">Kart Etiketi</label><input
                        type="text" id="cardName" placeholder="Advantage Gold..."
                        class="w-full p-4 bg-gray-50 dark:bg-gray-700 text-sm"></div>
                <div><label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">G√ºncel Ekstre Borcu</label><input
                        type="text" id="cDebt" inputmode="decimal" oninput="maskInput(this)" placeholder="0,00"
                        class="w-full p-5 bg-gray-50 dark:bg-gray-700 text-2xl font-bold"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-[9px] text-gray-400 font-bold uppercase">Kesim Tarihi</label><input
                            type="date" id="cCutoff"
                            class="w-full p-3 bg-gray-50 dark:bg-gray-700 text-xs text-gray-600 dark:text-gray-300">
                    </div>
                    <div><label class="text-[9px] text-gray-400 font-bold uppercase text-[#DA291C]">Son
                            √ñdeme</label><input type="date" id="cDue"
                            class="w-full p-3 bg-gray-50 dark:bg-gray-700 text-xs text-gray-600 dark:text-gray-300">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[9px] text-gray-400 font-bold uppercase text-yellow-500">Birikmi≈ü
                            Bonus</label>
                        <input type="text" id="cBonus" inputmode="decimal" oninput="maskInput(this)" placeholder="0,00"
                            class="w-full p-3 bg-gray-50 dark:bg-gray-700 text-sm font-bold">
                    </div>
                    <div>
                        <label class="text-[9px] text-gray-400 font-bold uppercase">Kesim Hatƒ±rlatƒ±cƒ±</label>
                        <select id="cCutoffLead"
                            class="w-full p-3 bg-gray-50 dark:bg-gray-700 text-xs rounded-xl border-none">
                            <option value="-1">ƒ∞stemiyorum</option>
                            <option value="0">G√ºn√ºnde</option>
                            <option value="1">1 G√ºn √ñnce</option>
                            <option value="2">2 G√ºn √ñnce</option>
                            <option value="3">3 G√ºn √ñnce</option>
                            <option value="101">1 G√ºn Sonra</option>
                            <option value="102">2 G√ºn Sonra</option>
                            <option value="103">3 G√ºn Sonra</option>
                            <option value="104">4 G√ºn Sonra</option>
                            <option value="105">5 G√ºn Sonra</option>
                        </select>
                    </div>
                </div>
            </div>
            <button onclick="saveCard()" class="w-full mt-6 ak-btn-primary py-5">Bƒ∞Tƒ∞R</button>
        </div>
    </div>

    <div id="personModal"
        class="modal-overlay hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-6 z-[2000]">
        <div class="modal-content bg-white dark:bg-slate-800 p-6 w-full max-w-sm rounded-[2.5rem] shadow-2xl relative"
            onclick="event.stopPropagation()">
            <button onclick="closeModal('personModal')" class="absolute top-4 right-4 text-gray-300">‚úï</button>
            <h2 class="text-xl font-bold mb-6">Ki≈üi / Kurum Ekle</h2>
            <input type="text" id="personName" placeholder="Ad Soyad veya Kurum Adƒ±"
                class="w-full p-4 bg-gray-50 dark:bg-gray-700 text-sm mb-4 border dark:border-gray-600 rounded-2xl">

            <div class="space-y-3 mb-6">
                <!-- VADE TOGGLE -->
                <button id="btnPMainVade" onclick="toggleVadeUI()"
                    class="w-full p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl flex justify-between items-center group transition-all active:scale-95">
                    <span class="text-xs font-bold text-gray-500 group-[.active]:text-[#DA291C]">Vade Tarihi Var
                        mƒ±?</span>
                    <span class="indicator text-gray-300 group-[.active]:text-[#DA291C]">‚ö™</span>
                </button>
                <input type="hidden" id="pHasVade" value="0">

                <div id="pVadeContainer" class="hidden animate-slideDown">
                    <label class="text-[9px] text-gray-400 font-bold uppercase ml-1">Vade Tarihi</label>
                    <input type="date" id="pDueDate" class="w-full p-3 bg-gray-50 dark:bg-gray-700 text-sm rounded-xl">
                </div>

                <!-- TAKSƒ∞T TOGGLE (v17 NEW) -->
                <button id="btnPMainTaksit" onclick="togglePTaksitUI()"
                    class="w-full p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl flex justify-between items-center group transition-all active:scale-95">
                    <span class="text-xs font-bold text-gray-500 group-[.active]:text-green-600 uppercase">Taksit
                        Se√ßeneƒüi?</span>
                    <span class="indicator text-gray-300 group-[.active]:text-green-600">‚ö™</span>
                </button>
                <input type="hidden" id="pIsInstallment" value="0">

                <!-- DIRECT DEBT ENTRY (v20 NEW) -->
                <div id="pDebtEntryContainer" class="hidden space-y-4 animate-slideDown">
                    <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                        <label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">Bor√ß Tutarƒ±</label>
                        <input type="text" id="pAmount" inputmode="decimal" oninput="maskInput(this)" placeholder="0,00"
                            class="w-full p-4 bg-gray-100 dark:bg-gray-700/50 text-xl font-bold border-none rounded-2xl">
                    </div>

                    <div id="pTaksitArea" class="hidden space-y-3">
                        <label class="text-[9px] text-gray-400 font-bold uppercase ml-1">Taksit Sayƒ±sƒ± ve ƒ∞lk
                            √ñdeme</label>
                        <div class="flex gap-2">
                            <input type="number" id="pTCount" placeholder="Sayƒ±"
                                oninput="generatePInstallmentRows(this.value)"
                                class="w-20 p-3 bg-gray-200 dark:bg-gray-600 text-sm rounded-xl font-bold text-center">
                            <input type="date" id="pTBaseDate"
                                onchange="generatePInstallmentRows(document.getElementById('pTCount').value)"
                                class="flex-1 p-3 bg-gray-100 dark:bg-gray-700 text-[10px] rounded-xl font-bold">
                        </div>
                        <div id="pInstallmentList" class="space-y-2 max-h-[150px] overflow-y-auto pr-2 custom-scroll">
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                    <span class="text-xs font-bold text-gray-500 italic">Bildirim ƒ∞stiyor musun?</span>
                    <select id="pLeadTime" class="p-2 bg-transparent text-[10px] font-bold border-none outline-none">
                        <option value="-1">ƒ∞stemiyorum</option>
                        <option value="0">G√ºn√ºnde</option>
                        <option value="1" selected>1 G√ºn √ñnce</option>
                        <option value="2">2 G√ºn √ñnce</option>
                        <option value="3">3 G√ºn √ñnce</option>
                        <option value="4">4 G√ºn √ñnce</option>
                        <option value="5">5 G√ºn √ñnce</option>
                        <option value="6">6 G√ºn √ñnce</option>
                        <option value="7">7 G√ºn √ñnce</option>
                    </select>
                </div>
            </div>

            <button onclick="savePerson()" class="w-full ak-btn-primary py-5 uppercase font-black text-xs">Kƒ∞≈ûƒ∞Yƒ∞
                KAYDET</button>
        </div>
    </div>

    <div id="transactionModal"
        class="modal-overlay hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-6 z-[2000]">
        <div class="modal-content bg-white dark:bg-slate-800 p-6 w-full max-w-sm rounded-[2.5rem] shadow-2xl relative"
            onclick="event.stopPropagation()">
            <button onclick="closeModal('transactionModal')" class="absolute top-4 right-4 text-gray-300">‚úï</button>
            <h2 id="transModalTitle" class="text-xl font-bold mb-6">ƒ∞≈ülem Yap</h2>
            <input type="hidden" id="transType">
            <input type="hidden" id="editTransIdx">

            <div class="space-y-4">
                <div><label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">Tutar</label><input type="text"
                        id="tAmount" inputmode="decimal" oninput="maskInput(this)" placeholder="0,00"
                        class="w-full p-5 bg-gray-50 dark:bg-gray-700 text-2xl font-bold border-none"></div>
                <div><label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">A√ßƒ±klama</label><input
                        type="text" id="tDesc" placeholder="Neden veya Not..."
                        class="w-full p-4 bg-gray-50 dark:bg-gray-700 text-sm border-none"></div>

                <button id="btnTMainTaksit" onclick="toggleTaksitUI()"
                    class="w-full p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl flex justify-between items-center group transition-all active:scale-95">
                    <span class="text-xs font-bold text-gray-500 group-[.active]:text-green-600 uppercase">Taksitli
                        mi?</span>
                    <span class="indicator text-gray-300 group-[.active]:text-green-600">‚ö™</span>
                </button>
                <input type="hidden" id="tIsInstallment" value="0">

                <div id="taksitContainer"
                    class="hidden space-y-3 animate-slideDown max-h-[220px] overflow-y-auto pr-2 custom-scroll">
                    <div class="flex flex-col gap-2">
                        <label class="text-[9px] text-gray-400 font-bold uppercase ml-1">Taksit Sayƒ±sƒ± ve ƒ∞lk
                            √ñdeme</label>
                        <div class="flex gap-2">
                            <input type="number" id="tCount" placeholder="Sayƒ±"
                                oninput="generateInstallmentRows(this.value)"
                                class="w-20 p-3 bg-gray-200 dark:bg-gray-600 text-sm rounded-xl font-bold text-center">
                            <input type="date" id="tBaseDate"
                                onchange="generateInstallmentRows(document.getElementById('tCount').value)"
                                class="flex-1 p-3 bg-gray-100 dark:bg-gray-700 text-[10px] rounded-xl font-bold">
                        </div>
                    </div>
                    <div id="installmentList" class="space-y-2"></div>
                </div>
            </div>

            <div class="flex gap-2 mt-6">
                <button id="btnDeleteTrans" onclick="deleteTransaction()"
                    class="hidden flex-1 bg-gray-100 dark:bg-gray-700 text-gray-400 py-5 rounded-2xl text-[10px] font-bold uppercase">Sƒ∞L</button>
                <button onclick="saveTransaction()"
                    class="flex-[3] ak-btn-primary py-5 uppercase font-black text-xs tracking-widest">ƒ∞≈ûLEMƒ∞
                    KAYDET</button>
            </div>
        </div>
    </div>

    <!-- Bonus List Modal -->
    <div id="bonusModal"
        class="modal-overlay hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-6 z-[2000]">
        <div class="modal-content bg-white dark:bg-slate-800 p-6 w-full max-w-sm rounded-[2.5rem] shadow-2xl relative"
            onclick="event.stopPropagation()">
            <button onclick="closeModal('bonusModal')"
                class="absolute top-6 right-6 text-gray-300 hover:text-gray-500 transition-colors">‚úï</button>
            <h2 class="text-xl font-bold mb-6">Bonuslarƒ±m</h2>
            <div id="bonusList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scroll"></div>
            <div class="mt-6 pt-4 border-t dark:border-gray-700 flex justify-between items-center">
                <span class="text-xs font-bold text-gray-400 uppercase">TOPLAM BONUS</span>
                <span id="totalBonusAmount" class="text-lg font-bold text-yellow-600">0,00 TL</span>
            </div>
        </div>
    </div>

    <!-- PREMIUM SHIFRE DEGISTIRME (PIN) -->
    <div id="pinChangeModal"
        class="modal-overlay hidden fixed inset-0 bg-black/95 backdrop-blur-md flex items-center justify-center p-6 z-[3000]">
        <div class="w-full max-w-sm text-white">
            <div class="mb-8 text-center">
                <h2 id="pinChangeTitle" class="text-2xl font-bold mb-2 uppercase">G√úVENLƒ∞K</h2>
                <p id="pinChangeStatus" class="opacity-70 text-sm font-medium">L√ºtfen mevcut ≈üifreyi girin</p>
            </div>

            <div class="flex gap-6 mb-8 justify-center" id="pinChangeDisplay">
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
            </div>

            <div class="numpad text-white">
                <style>
                    #pinChangeModal .num-btn {
                        color: white !important;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                    }

                    #pinChangeModal .pin-dot {
                        background: rgba(255, 255, 255, 0.2) !important;
                    }

                    #pinChangeModal .pin-dot.filled {
                        background: white !important;
                        box-shadow: 0 0 15px white !important;
                    }
                </style>
                <button class="num-btn" onclick="pressChangePinNum(1)">1</button>
                <button class="num-btn" onclick="pressChangePinNum(2)">2</button>
                <button class="num-btn" onclick="pressChangePinNum(3)">3</button>
                <button class="num-btn" onclick="pressChangePinNum(4)">4</button>
                <button class="num-btn" onclick="pressChangePinNum(5)">5</button>
                <button class="num-btn" onclick="pressChangePinNum(6)">6</button>
                <button class="num-btn" onclick="pressChangePinNum(7)">7</button>
                <button class="num-btn" onclick="pressChangePinNum(8)">8</button>
                <button class="num-btn" onclick="pressChangePinNum(9)">9</button>
                <button class="num-btn" style="background:transparent" onclick="clearChangePin()">C</button>
                <button class="num-btn" onclick="pressChangePinNum(0)">0</button>
                <button class="num-btn" style="background:transparent" onclick="closeModal('pinChangeModal')">‚úï</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Servis ƒ∞≈ü√ßisi Kaydedildi:', reg))
                    .catch(err => console.log('Servis ƒ∞≈ü√ßisi Hatasƒ±:', err));
            });
        }
    </script>
</body>

</html>